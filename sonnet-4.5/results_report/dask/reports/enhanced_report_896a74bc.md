# Bug Report: dask.utils.ndeepmap Silent Data Loss with Non-Positive Depth

**Target**: `dask.utils.ndeepmap`
**Severity**: High
**Bug Type**: Logic
**Date**: 2025-09-25

## Summary

`dask.utils.ndeepmap(n, func, seq)` silently discards all elements except the first when `n <= 0` and `seq` is a list with multiple elements, causing silent data corruption without any warning or error.

## Property-Based Test

```python
from hypothesis import given, settings, strategies as st
import dask.utils

@given(st.lists(st.integers(), min_size=2))
@settings(max_examples=100)
def test_ndeepmap_zero_depth_discards_elements(lst):
    """Test that reveals ndeepmap silently discards all but the first element when n=0"""
    inc = lambda x: x + 1
    result = dask.utils.ndeepmap(0, inc, lst)
    expected_if_only_first = inc(lst[0])
    assert result == expected_if_only_first
    print(f"✓ Test passed for list {lst}: ndeepmap(0, inc, {lst}) = {result} == inc({lst[0]}) = {expected_if_only_first}")

if __name__ == "__main__":
    # Run the property test
    print("Running Hypothesis property-based test for ndeepmap bug...")
    print("=" * 60)
    test_ndeepmap_zero_depth_discards_elements()
    print("\nAll tests passed! This confirms the bug: ndeepmap with n=0 silently discards all elements except the first!")
```

<details>

<summary>
**Failing input**: `[0, 0]`
</summary>
```
Running Hypothesis property-based test for ndeepmap bug...
============================================================
✓ Test passed for list [0, 0]: ndeepmap(0, inc, [0, 0]) = 1 == inc(0) = 1
✓ Test passed for list [-64, 0]: ndeepmap(0, inc, [-64, 0]) = -63 == inc(-64) = -63
✓ Test passed for list [-64, -14142]: ndeepmap(0, inc, [-64, -14142]) = -63 == inc(-64) = -63
✓ Test passed for list [1120402506070886141, 0]: ndeepmap(0, inc, [1120402506070886141, 0]) = 1120402506070886142 == inc(1120402506070886141) = 1120402506070886142
✓ Test passed for list [1120402506070886141, -8365, -30024, 6]: ndeepmap(0, inc, [1120402506070886141, -8365, -30024, 6]) = 1120402506070886142 == inc(1120402506070886141) = 1120402506070886142
✓ Test passed for list [-2208654177999991238, 0]: ndeepmap(0, inc, [-2208654177999991238, 0]) = -2208654177999991237 == inc(-2208654177999991238) = -2208654177999991237
✓ Test passed for list [-2208654177999991238, 19161, -6281, -13, 39, -16957, 25462, 16]: ndeepmap(0, inc, [-2208654177999991238, 19161, -6281, -13, 39, -16957, 25462, 16]) = -2208654177999991237 == inc(-2208654177999991238) = -2208654177999991237
✓ Test passed for list [-74848156217406396886701158245641326283, 0]: ndeepmap(0, inc, [-74848156217406396886701158245641326283, 0]) = -74848156217406396886701158245641326282 == inc(-74848156217406396886701158245641326283) = -74848156217406396886701158245641326282
✓ Test passed for list [-74848156217406396886701158245641326283, 5, 24746, 4785558115056087819, -27552]: ndeepmap(0, inc, [-74848156217406396886701158245641326283, 5, 24746, 4785558115056087819, -27552]) = -74848156217406396886701158245641326282 == inc(-74848156217406396886701158245641326283) = -74848156217406396886701158245641326282
✓ Test passed for list [17472, 0]: ndeepmap(0, inc, [17472, 0]) = 17473 == inc(17472) = 17473
✓ Test passed for list [17472, 25639, 9009, -20]: ndeepmap(0, inc, [17472, 25639, 9009, -20]) = 17473 == inc(17472) = 17473
✓ Test passed for list [-20, 25639, 9009, -20]: ndeepmap(0, inc, [-20, 25639, 9009, -20]) = -19 == inc(-20) = -19
✓ Test passed for list [-20, 25639, 25639, -20]: ndeepmap(0, inc, [-20, 25639, 25639, -20]) = -19 == inc(-20) = -19
✓ Test passed for list [25639, 25639, 25639, -20]: ndeepmap(0, inc, [25639, 25639, 25639, -20]) = 25640 == inc(25639) = 25640
✓ Test passed for list [25639, -20, 25639, -20]: ndeepmap(0, inc, [25639, -20, 25639, -20]) = 25640 == inc(25639) = 25640
✓ Test passed for list [-20, -20, 25639, -20]: ndeepmap(0, inc, [-20, -20, 25639, -20]) = -19 == inc(-20) = -19
✓ Test passed for list [24942, 100]: ndeepmap(0, inc, [24942, 100]) = 24943 == inc(24942) = 24943
✓ Test passed for list [24942, 24942]: ndeepmap(0, inc, [24942, 24942]) = 24943 == inc(24942) = 24943
✓ Test passed for list [100, 3734, 5275, -27355, -121, -10580]: ndeepmap(0, inc, [100, 3734, 5275, -27355, -121, -10580]) = 101 == inc(100) = 101
✓ Test passed for list [100, 3734, 5275, 5275, -121, -10580]: ndeepmap(0, inc, [100, 3734, 5275, 5275, -121, -10580]) = 101 == inc(100) = 101
✓ Test passed for list [100, 3734, 3734, 5275, -121, -10580]: ndeepmap(0, inc, [100, 3734, 3734, 5275, -121, -10580]) = 101 == inc(100) = 101
✓ Test passed for list [100, 3734, 3734, 5275, -10580, -10580]: ndeepmap(0, inc, [100, 3734, 3734, 5275, -10580, -10580]) = 101 == inc(100) = 101
✓ Test passed for list [100, 3734, 3734, 5275, -10580]: ndeepmap(0, inc, [100, 3734, 3734, 5275, -10580]) = 101 == inc(100) = 101
✓ Test passed for list [100, 3734]: ndeepmap(0, inc, [100, 3734]) = 101 == inc(100) = 101
✓ Test passed for list [3734, 3734]: ndeepmap(0, inc, [3734, 3734]) = 3735 == inc(3734) = 3735
✓ Test passed for list [28915, -9574, -2835609799544258122, -26237, -15989]: ndeepmap(0, inc, [28915, -9574, -2835609799544258122, -26237, -15989]) = 28916 == inc(28915) = 28916
✓ Test passed for list [28915, -9574, -2835609799544258122, -26237, -9574]: ndeepmap(0, inc, [28915, -9574, -2835609799544258122, -26237, -9574]) = 28916 == inc(28915) = 28916
✓ Test passed for list [-2835609799544258122, -9574, -2835609799544258122, -26237, -9574]: ndeepmap(0, inc, [-2835609799544258122, -9574, -2835609799544258122, -26237, -9574]) = -2835609799544258121 == inc(-2835609799544258122) = -2835609799544258121
✓ Test passed for list [-2835609799544258122, -9574, -9574, -26237, -9574]: ndeepmap(0, inc, [-2835609799544258122, -9574, -9574, -26237, -9574]) = -2835609799544258121 == inc(-2835609799544258122) = -2835609799544258121
✓ Test passed for list [-2835609799544258122, -9574, -9574, -26237, -26237]: ndeepmap(0, inc, [-2835609799544258122, -9574, -9574, -26237, -26237]) = -2835609799544258121 == inc(-2835609799544258122) = -2835609799544258121
✓ Test passed for list [-2835609799544258122, -26237, -9574, -26237, -26237]: ndeepmap(0, inc, [-2835609799544258122, -26237, -9574, -26237, -26237]) = -2835609799544258121 == inc(-2835609799544258122) = -2835609799544258121
✓ Test passed for list [211247992881769377, -28073, 1099851464, -123, -8397, -3, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, 714, 29689]: ndeepmap(0, inc, [211247992881769377, -28073, 1099851464, -123, -8397, -3, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, 714, 29689]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, 714, 29689]: ndeepmap(0, inc, [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, 714, 29689]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397, 29689]: ndeepmap(0, inc, [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397, 29689]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397]: ndeepmap(0, inc, [211247992881769377, -28073, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [211247992881769377, -106, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397]: ndeepmap(0, inc, [211247992881769377, -106, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, 74, 78600655012037694398511741077241841835, -14867, -8397]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [211247992881769377, -106, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, -106, 78600655012037694398511741077241841835, -14867, -8397]: ndeepmap(0, inc, [211247992881769377, -106, 1099851464, -123, -8397, -2831309490686836435, -106, -2831309490686836435, -106, 78600655012037694398511741077241841835, -14867, -8397]) = 211247992881769378 == inc(211247992881769377) = 211247992881769378
✓ Test passed for list [-6849, -23858, -9228, 18859570875750333267399705684980093784, -25046, 122, 19045, 4176100323871938865, -8447106745483060572, 18113, 19429, -120, -17932, -30570]: ndeepmap(0, inc, [-6849, -23858, -9228, 18859570875750333267399705684980093784, -25046, 122, 19045, 4176100323871938865, -8447106745483060572, 18113, 19429, -120, -17932, -30570]) = -6848 == inc(-6849) = -6848
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, -8029005051532260985, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 2904, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, -8029005051532260985, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 2904, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 2904, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 2904, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, -28516, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, -6254, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, 61, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, -15, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, 7585, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, -15, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [30487, -143834037677894890883566803520293631785, -17549, -2737116350218522061, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, -15, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]: ndeepmap(0, inc, [30487, -143834037677894890883566803520293631785, -17549, -2737116350218522061, 26143, -2737116350218522061, 14101, -30, 16561, -27593, 11956, 748339619, -15, -13, 16561, -9755, -23458, -18759, 27299, 61, 11956, 3598, -14301, -15, -158131014320772732245452957070641797607, 11956, -13190, 1823874240]) = 30488 == inc(30487) = 30488
✓ Test passed for list [92, 87, 5660, -22, -109, 122, -64, 98, -14124]: ndeepmap(0, inc, [92, 87, 5660, -22, -109, 122, -64, 98, -14124]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 5660, -22, -109, -14124, -64, 98, -14124]: ndeepmap(0, inc, [92, 87, 5660, -22, -109, -14124, -64, 98, -14124]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 5660, -22, -109, -14124, -64, 98, 87]: ndeepmap(0, inc, [92, 87, 5660, -22, -109, -14124, -64, 98, 87]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 5660, -22, -109, -22, -64, 98, 87]: ndeepmap(0, inc, [92, 87, 5660, -22, -109, -22, -64, 98, 87]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 5660, -22, 87, -22, -64, 98, 87]: ndeepmap(0, inc, [92, 87, 5660, -22, 87, -22, -64, 98, 87]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 87, -22, 87, -22, -64, 98, 87]: ndeepmap(0, inc, [92, 87, 87, -22, 87, -22, -64, 98, 87]) = 93 == inc(92) = 93
✓ Test passed for list [92, 87, 87, -22, -22, -22, -64, 98, 87]: ndeepmap(0, inc, [92, 87, 87, -22, -22, -22, -64, 98, 87]) = 93 == inc(92) = 93
✓ Test passed for list [7, -30686]: ndeepmap(0, inc, [7, -30686]) = 8 == inc(7) = 8
✓ Test passed for list [7, 7]: ndeepmap(0, inc, [7, 7]) = 8 == inc(7) = 8
✓ Test passed for list [17507, -1, -98389737213027230593273355481761716735, -21352, 20365, -84, -17488, -22, 100, 12555]: ndeepmap(0, inc, [17507, -1, -98389737213027230593273355481761716735, -21352, 20365, -84, -17488, -22, 100, 12555]) = 17508 == inc(17507) = 17508
✓ Test passed for list [17507, -1, -98389737213027230593273355481761716735, -21352, 20365, -84, 100, -22, 100, 12555]: ndeepmap(0, inc, [17507, -1, -98389737213027230593273355481761716735, -21352, 20365, -84, 100, -22, 100, 12555]) = 17508 == inc(17507) = 17508
✓ Test passed for list [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, -84, 100, -22, 100, 12555]: ndeepmap(0, inc, [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, -84, 100, -22, 100, 12555]) = 17508 == inc(17507) = 17508
✓ Test passed for list [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, 12555]: ndeepmap(0, inc, [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, 12555]) = 17508 == inc(17507) = 17508
✓ Test passed for list [12555, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, 12555]: ndeepmap(0, inc, [12555, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, 12555]) = 12556 == inc(12555) = 12556
✓ Test passed for list [12555, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, -98389737213027230593273355481761716735]: ndeepmap(0, inc, [12555, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, -98389737213027230593273355481761716735]) = 12556 == inc(12555) = 12556
✓ Test passed for list [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, -98389737213027230593273355481761716735]: ndeepmap(0, inc, [17507, -22, -98389737213027230593273355481761716735, -21352, 20365, 17507, 100, -22, 100, -98389737213027230593273355481761716735]) = 17508 == inc(17507) = 17508
✓ Test passed for list [-858406498, -21510, 20604, -12963, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -21510, 20604, -12963, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -21510, 20604, -7662, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -21510, 20604, -7662, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -21510, -19555, -7662, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -21510, -19555, -7662, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -21510, -19555, -19555, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -21510, -19555, -19555, -7662, -70881553523355271726527828009470415903, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -21510, -19555, -19555, -7662, -858406498, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -21510, -19555, -19555, -7662, -858406498, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -27069, -19555, -19555, -7662, -858406498, -33, -27069, -19555]: ndeepmap(0, inc, [-858406498, -27069, -19555, -19555, -7662, -858406498, -33, -27069, -19555]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [-858406498, -27069, -19555, -19555, -7662, -858406498]: ndeepmap(0, inc, [-858406498, -27069, -19555, -19555, -7662, -858406498]) = -858406497 == inc(-858406498) = -858406497
✓ Test passed for list [19168, 16054]: ndeepmap(0, inc, [19168, 16054]) = 19169 == inc(19168) = 19169
✓ Test passed for list [19168, 19168]: ndeepmap(0, inc, [19168, 19168]) = 19169 == inc(19168) = 19169
✓ Test passed for list [183, -10006, 10322, -15, 37, 29005, -19679, 100, 10307, -27634]: ndeepmap(0, inc, [183, -10006, 10322, -15, 37, 29005, -19679, 100, 10307, -27634]) = 184 == inc(183) = 184
✓ Test passed for list [183, -10006, 10322, -15, 37, 29005, -19679, 100, -19679, -27634]: ndeepmap(0, inc, [183, -10006, 10322, -15, 37, 29005, -19679, 100, -19679, -27634]) = 184 == inc(183) = 184
✓ Test passed for list [183, -10006, 10322, -15, 37, -10006, -19679, 100, -19679, -27634]: ndeepmap(0, inc, [183, -10006, 10322, -15, 37, -10006, -19679, 100, -19679, -27634]) = 184 == inc(183) = 184
✓ Test passed for list [183, -10006, 10322, -15, 37, -10006, 37, 100, -19679, -27634]: ndeepmap(0, inc, [183, -10006, 10322, -15, 37, -10006, 37, 100, -19679, -27634]) = 184 == inc(183) = 184
✓ Test passed for list [-19679, -10006, 10322, -15, 37, -10006, 37, 100, -19679, -27634]: ndeepmap(0, inc, [-19679, -10006, 10322, -15, 37, -10006, 37, 100, -19679, -27634]) = -19678 == inc(-19679) = -19678
✓ Test passed for list [-19679, -10006]: ndeepmap(0, inc, [-19679, -10006]) = -19678 == inc(-19679) = -19678
✓ Test passed for list [-10006, -10006]: ndeepmap(0, inc, [-10006, -10006]) = -10005 == inc(-10006) = -10005
✓ Test passed for list [127, -32686, 17305]: ndeepmap(0, inc, [127, -32686, 17305]) = 128 == inc(127) = 128
✓ Test passed for list [17305, -32686, 17305]: ndeepmap(0, inc, [17305, -32686, 17305]) = 17306 == inc(17305) = 17306
✓ Test passed for list [17305, 17305, 17305]: ndeepmap(0, inc, [17305, 17305, 17305]) = 17306 == inc(17305) = 17306
✓ Test passed for list [32597, -17508]: ndeepmap(0, inc, [32597, -17508]) = 32598 == inc(32597) = 32598
✓ Test passed for list [-17508, -17508]: ndeepmap(0, inc, [-17508, -17508]) = -17507 == inc(-17508) = -17507
✓ Test passed for list [9177, 14454, -7306782224108372867, 16399, -105135400, -2743, -16607, -6104, 12482, 20717]: ndeepmap(0, inc, [9177, 14454, -7306782224108372867, 16399, -105135400, -2743, -16607, -6104, 12482, 20717]) = 9178 == inc(9177) = 9178
✓ Test passed for list [37, 30852, -8121]: ndeepmap(0, inc, [37, 30852, -8121]) = 38 == inc(37) = 38
✓ Test passed for list [37, 30852]: ndeepmap(0, inc, [37, 30852]) = 38 == inc(37) = 38
✓ Test passed for list [37, 37]: ndeepmap(0, inc, [37, 37]) = 38 == inc(37) = 38
✓ Test passed for list [-26, 148666396, -9096056894594049329, -31354, -14742357859000198603356280846093045324, -3025405446617726053, 53, -1915713123, 4851]: ndeepmap(0, inc, [-26, 148666396, -9096056894594049329, -31354, -14742357859000198603356280846093045324, -3025405446617726053, 53, -1915713123, 4851]) = -25 == inc(-26) = -25
✓ Test passed for list [-26, 148666396, -9096056894594049329, -31354, -31354, -3025405446617726053, 53, -1915713123, 4851]: ndeepmap(0, inc, [-26, 148666396, -9096056894594049329, -31354, -31354, -3025405446617726053, 53, -1915713123, 4851]) = -25 == inc(-26) = -25
✓ Test passed for list [-26, 148666396, -9096056894594049329, -31354, -31354, -3025405446617726053, 53, 53, 4851]: ndeepmap(0, inc, [-26, 148666396, -9096056894594049329, -31354, -31354, -3025405446617726053, 53, 53, 4851]) = -25 == inc(-26) = -25
✓ Test passed for list [-26, 148666396, -9096056894594049329]: ndeepmap(0, inc, [-26, 148666396, -9096056894594049329]) = -25 == inc(-26) = -25
✓ Test passed for list [148666396, 148666396, -9096056894594049329]: ndeepmap(0, inc, [148666396, 148666396, -9096056894594049329]) = 148666397 == inc(148666396) = 148666397
✓ Test passed for list [-9096056894594049329, 148666396, -9096056894594049329]: ndeepmap(0, inc, [-9096056894594049329, 148666396, -9096056894594049329]) = -9096056894594049328 == inc(-9096056894594049329) = -9096056894594049328
✓ Test passed for list [6606762451355392122, -32487]: ndeepmap(0, inc, [6606762451355392122, -32487]) = 6606762451355392123 == inc(6606762451355392122) = 6606762451355392123
✓ Test passed for list [6606762451355392122, 6606762451355392122]: ndeepmap(0, inc, [6606762451355392122, 6606762451355392122]) = 6606762451355392123 == inc(6606762451355392122) = 6606762451355392123
✓ Test passed for list [-3847304658017682780, 34, -20863, 118, 803, -1954, 3997, -65]: ndeepmap(0, inc, [-3847304658017682780, 34, -20863, 118, 803, -1954, 3997, -65]) = -3847304658017682779 == inc(-3847304658017682780) = -3847304658017682779
✓ Test passed for list [-3847304658017682780, 34, -20863, 118, -1954, -1954, 3997, -65]: ndeepmap(0, inc, [-3847304658017682780, 34, -20863, 118, -1954, -1954, 3997, -65]) = -3847304658017682779 == inc(-3847304658017682780) = -3847304658017682779
✓ Test passed for list [-3847304658017682780, 34, -20863, 118, 118, -1954, 3997, -65]: ndeepmap(0, inc, [-3847304658017682780, 34, -20863, 118, 118, -1954, 3997, -65]) = -3847304658017682779 == inc(-3847304658017682780) = -3847304658017682779
✓ Test passed for list [3997, 34, -20863, 118, 118, -1954, 3997, -65]: ndeepmap(0, inc, [3997, 34, -20863, 118, 118, -1954, 3997, -65]) = 3998 == inc(3997) = 3998
✓ Test passed for list [3997, 34, 3997, 118, 118, -1954, 3997, -65]: ndeepmap(0, inc, [3997, 34, 3997, 118, 118, -1954, 3997, -65]) = 3998 == inc(3997) = 3998
✓ Test passed for list [3997, 34, 3997, 118, -65, -1954, 3997, -65]: ndeepmap(0, inc, [3997, 34, 3997, 118, -65, -1954, 3997, -65]) = 3998 == inc(3997) = 3998

All tests passed! This confirms the bug: ndeepmap with n=0 silently discards all elements except the first!
```
</details>

## Reproducing the Bug

```python
"""Demonstrating the dask.utils.ndeepmap silent data loss bug"""
import dask.utils

# Define a simple increment function
inc = lambda x: x + 1

print("Testing ndeepmap with depth 0:")
print("===============================")

# Test 1: Single element list
single_element = [1]
result1 = dask.utils.ndeepmap(0, inc, single_element)
print(f"ndeepmap(0, inc, [1]) = {result1}")

# Test 2: Multi-element list
multi_element = [1, 2, 3, 4, 5]
result2 = dask.utils.ndeepmap(0, inc, multi_element)
print(f"ndeepmap(0, inc, [1, 2, 3, 4, 5]) = {result2}")

# Demonstrate the data loss
print("\nData loss demonstration:")
print("-----------------------")
print(f"Input: {multi_element}")
print(f"Expected: All elements incremented")
print(f"Actual: Only first element processed, result = {result2}")
print(f"Elements lost: {multi_element[1:]}")

# Test with negative n
print("\nTesting with n = -1:")
print("--------------------")
negative_result = dask.utils.ndeepmap(-1, inc, [10, 20, 30])
print(f"ndeepmap(-1, inc, [10, 20, 30]) = {negative_result}")

# Compare with correct behavior when n=1
print("\nCorrect behavior when n = 1:")
print("-----------------------------")
correct_result = dask.utils.ndeepmap(1, inc, [10, 20, 30])
print(f"ndeepmap(1, inc, [10, 20, 30]) = {correct_result}")

# Demonstrate the issue with non-list types when n=0
print("\nBehavior with non-list types when n = 0:")
print("-----------------------------------------")
scalar_result = dask.utils.ndeepmap(0, inc, 42)
print(f"ndeepmap(0, inc, 42) = {scalar_result}")

# Show the silent nature of the bug
print("\nSilent data loss verification:")
print("------------------------------")
assert result1 == result2, "ERROR: Same result for different inputs!"
print(f"✓ Assertion passed: result1 ({result1}) == result2 ({result2})")
print("This confirms silent data loss - different inputs produce same output!")
```

<details>

<summary>
Output showing silent data loss
</summary>
```
Testing ndeepmap with depth 0:
===============================
ndeepmap(0, inc, [1]) = 2
ndeepmap(0, inc, [1, 2, 3, 4, 5]) = 2

Data loss demonstration:
-----------------------
Input: [1, 2, 3, 4, 5]
Expected: All elements incremented
Actual: Only first element processed, result = 2
Elements lost: [2, 3, 4, 5]

Testing with n = -1:
--------------------
ndeepmap(-1, inc, [10, 20, 30]) = 11

Correct behavior when n = 1:
-----------------------------
ndeepmap(1, inc, [10, 20, 30]) = [11, 21, 31]

Behavior with non-list types when n = 0:
-----------------------------------------
ndeepmap(0, inc, 42) = 43

Silent data loss verification:
------------------------------
✓ Assertion passed: result1 (2) == result2 (2)
This confirms silent data loss - different inputs produce same output!
```
</details>

## Why This Is A Bug

This bug violates fundamental expectations and principles in several critical ways:

1. **Silent Data Loss**: The function silently discards all elements except the first when `n <= 0` and the input is a multi-element list. This is the most severe type of bug as users have no indication their data is being lost.

2. **Documentation Contradiction**: The docstring states "Call a function on every element within a nested container" but when `n <= 0`, it only processes the first element of lists, directly contradicting the documented behavior.

3. **Inconsistent Behavior**: The function treats lists and non-lists differently when `n <= 0`:
   - Lists: Only first element is processed (`return func(seq[0])`)
   - Non-lists: Entire value is processed (`return func(seq)`)

   This inconsistency makes the function unpredictable.

4. **Testing Gap**: The existing test in `dask/tests/test_utils.py:492` only tests with a single-element list `[1]`, which doesn't expose the bug since there's only one element to process.

5. **No Input Validation**: The function accepts `n <= 0` without validation or documentation of expected behavior, leading to undefined and incorrect behavior.

6. **Principle of Least Surprise Violated**: No reasonable user would expect a function that processes nested containers to silently discard data based on the depth parameter being non-positive.

## Relevant Context

The `ndeepmap` function is located in `/home/npc/pbt/agentic-pbt/envs/dask_env/lib/python3.13/site-packages/dask/utils.py` at lines 302-318. The problematic code is at lines 315-318:

```python
elif isinstance(seq, list):
    return func(seq[0])  # Only processes first element!
else:
    return func(seq)
```

This function is used internally within Dask, particularly in `dask.array.core` for operations like `to_delayed()`. While it's primarily an internal utility, silent data loss in any part of a data processing library is critical.

The function appears to be a variant of `deepmap` (line 272) that allows specifying the depth of recursion. The special case for `n <= 0` seems intended to handle "zero depth" scenarios, but the implementation is flawed for multi-element lists.

Documentation: https://github.com/dask/dask/blob/main/dask/utils.py

## Proposed Fix

```diff
--- a/dask/utils.py
+++ b/dask/utils.py
@@ -309,7 +309,11 @@ def ndeepmap(n, func, seq):
         return [func(item) for item in seq]
     elif n > 1:
         return [ndeepmap(n - 1, func, item) for item in seq]
     elif isinstance(seq, list):
-        return func(seq[0])
+        if len(seq) != 1:
+            raise ValueError(
+                f"ndeepmap with depth {n} expects a single-element list, got {len(seq)} elements. "
+                f"Use depth=1 to apply function to all elements."
+            )
+        return func(seq[0])
     else:
         return func(seq)
```