<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Property-Based Testing: Finding Bugs Across the Python Ecosystem</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <style>
        body {
            font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-weight: 300;
            margin-top: 30px;
        }

        .container {
            max-width: 1000px;
        }

        h1 {
            font-size: 36px;
            font-weight: 300;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 28px;
            font-weight: 300;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        h3 {
            font-size: 20px;
            font-weight: 300;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        /* Tab styles */
        .model-tabs {
            margin: 30px 0 0 0;
            border-bottom: 2px solid #ddd;
        }

        .model-tabs ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
        }

        .model-tabs li {
            margin-right: 5px;
        }

        .model-tabs button {
            padding: 12px 30px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 400;
            transition: background 0.2s;
        }

        .model-tabs button:hover {
            background: #e8e8e8;
        }

        .model-tabs button.active {
            background: white;
            border-bottom: 2px solid white;
            margin-bottom: -2px;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .filter-section {
            margin: 30px 0;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .filter-row {
            margin-bottom: 15px;
        }

        .bug-report-section {
            margin-top: 40px;
        }

        .report-table {
            margin-top: 20px;
        }

        .report-table th {
            background-color: #f5f5f5;
            font-weight: 400;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .report-table td {
            vertical-align: middle;
        }

        .report-row {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .report-row:hover {
            background-color: #f0f0f0 !important;
        }

        .severity-critical {
            color: #c9302c;
            font-weight: 700;
        }

        .severity-high {
            color: #d9534f;
            font-weight: 600;
        }

        .severity-medium {
            color: #f0ad4e;
            font-weight: 600;
        }

        .severity-low {
            color: #5bc0de;
            font-weight: 600;
        }

        .package-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }

        .category-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .category-BUG {
            background: #d4f8d4;
            color: #0a6b0a;
        }

        .category-INVALID {
            background: #ffd4d4;
            color: #8b0000;
        }

        .category-WONTFIX {
            background: #ffe4cc;
            color: #cc6600;
        }

        .category-DOCUMENTATION_FIX {
            background: #d4e8ff;
            color: #0066cc;
        }

        .category-FEATURE_REQUEST {
            background: #f0d4ff;
            color: #7700cc;
        }

        .category-UNKNOWN {
            background: #f0f0f0;
            color: #666;
        }

        .btn-view {
            padding: 2px 10px;
            font-size: 12px;
        }

        .footer {
            margin-top: 60px;
            padding: 40px 0;
            border-top: 1px solid #e5e5e5;
            text-align: center;
            color: #999;
        }

        /* Modal styles for report viewing */
        .report-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }

        .report-content {
            background-color: #fff;
            margin: 2% auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            z-index: 1001;
        }

        .close-btn:hover {
            color: #000;
        }

        .report-content h1 {
            font-size: 24px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .report-content h2 {
            font-size: 20px;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #333;
        }

        .report-content pre {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            overflow-x: auto;
        }

        .report-content code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .report-content pre code {
            background-color: transparent;
            padding: 0;
        }

        .report-content strong {
            font-weight: 600;
        }

        .report-content p {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .score-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .score-na {
            background: #e0e0e0;
            color: #666;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-valid {
            background: #d4f8d4;
            color: #0a6b0a;
        }

        .status-invalid {
            background: #ffd4d4;
            color: #8b0000;
        }

        .status-unknown {
            background: #f0f0f0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <h1>Agentic Property-Based Testing: Finding Bugs Across the Python Ecosystem</h1>
                <p class="lead">Use this website to browse the bug reports our agent found.</p>
                <p>If you're a maintainer of a Python package we tested, you can help us by <a href="https://github.com/mmaaz-git/agentic-pbt-site/blob/main/CONTRIBUTING.md">validating bugs!</a></p>
                <div style="margin: 20px 0;">
                    <a href="https://arxiv.org/abs/2510.09907" class="btn btn-primary btn-lg" style="margin: 0 10px;">
                        <i class="fa fa-file-text"></i> Paper
                    </a>
                    <a href="https://github.com/mmaaz-git/agentic-pbt" class="btn btn-success btn-lg" style="margin: 0 10px;">
                        <i class="fa fa-github"></i> Code
                    </a>
                </div>
            </div>
        </div>

        <!-- Model Selection Tabs -->
        <div class="model-tabs">
            <ul>
                <li><button id="opusTab" class="active" onclick="switchModel('opus')">Opus 4.1</button></li>
                <li><button id="sonnetTab" onclick="switchModel('sonnet')">Sonnet 4.5</button></li>
            </ul>
        </div>

        <!-- Opus Content -->
        <div id="opusContent" class="tab-content active">
            <div class="row">
                <div class="col-md-12">
                    <div class="filter-section">
                        <div class="row filter-row">
                            <div class="col-md-2">
                                <label>Search:</label>
                                <input type="text" class="form-control" id="opusSearchInput" placeholder="Search...">
                            </div>
                            <div class="col-md-2">
                                <label>Package:</label>
                                <select class="form-control" id="opusPackageFilter">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>Min Score:</label>
                                <input type="number" class="form-control" id="opusMinScoreFilter" min="0" max="15" placeholder="0">
                            </div>
                            <div class="col-md-2">
                                <label>Max Score:</label>
                                <input type="number" class="form-control" id="opusMaxScoreFilter" min="0" max="15" placeholder="15">
                            </div>
                            <div class="col-md-2">
                                <label>Status:</label>
                                <select class="form-control" id="opusStatusFilter">
                                    <option value="">All</option>
                                    <option value="unknown">Unknown</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>&nbsp;</label>
                                <button class="btn btn-default btn-block" onclick="clearOpusFilters()">Clear</button>
                            </div>
                        </div>
                    </div>

                    <div class="bug-report-section">
                        <table class="table table-striped report-table">
                            <thead>
                                <tr>
                                    <th>Package</th>
                                    <th>Title</th>
                                    <th>Score</th>
                                    <th>Report</th>
                                    <th>Review</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="opusTableBody">
                                <tr><td colspan="6" class="text-center">Loading reports...</td></tr>
                            </tbody>
                        </table>

                        <div class="text-center">
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="opusPaginationControls"></ul>
                            </nav>
                            <div style="margin-top: 10px;">
                                <label style="margin-right: 10px;">Show:</label>
                                <select id="opusPageSize" class="form-control" style="width: auto; display: inline-block;">
                                    <option value="25">25</option>
                                    <option value="50" selected>50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                </select>
                                <span style="margin-left: 10px;" id="opusRecordInfo"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sonnet Content -->
        <div id="sonnetContent" class="tab-content">
            <div class="row">
                <div class="col-md-12">
                    <div class="filter-section">
                        <div class="row filter-row">
                            <div class="col-md-2">
                                <label>Search:</label>
                                <input type="text" class="form-control" id="sonnetSearchInput" placeholder="Search...">
                            </div>
                            <div class="col-md-2">
                                <label>Package:</label>
                                <select class="form-control" id="sonnetPackageFilter">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>Category:</label>
                                <select class="form-control" id="sonnetCategoryFilter">
                                    <option value="">All</option>
                                    <option value="BUG">BUG</option>
                                    <option value="INVALID">INVALID</option>
                                    <option value="WONTFIX">WONTFIX</option>
                                    <option value="DOCUMENTATION_FIX">DOCUMENTATION_FIX</option>
                                    <option value="FEATURE_REQUEST">FEATURE_REQUEST</option>
                                    <option value="UNKNOWN">UNKNOWN</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>Severity:</label>
                                <select class="form-control" id="sonnetSeverityFilter">
                                    <option value="">All</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>Status:</label>
                                <select class="form-control" id="sonnetStatusFilter">
                                    <option value="">All</option>
                                    <option value="unknown">Unknown</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label>&nbsp;</label>
                                <button class="btn btn-default btn-block" onclick="clearSonnetFilters()">Clear</button>
                            </div>
                        </div>
                    </div>

                    <div class="bug-report-section">
                        <table class="table table-striped report-table">
                            <thead>
                                <tr>
                                    <th>Package</th>
                                    <th>Title</th>
                                    <th>Report</th>
                                    <th>Analysis</th>
                                    <th>Category</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="sonnetTableBody">
                                <tr><td colspan="7" class="text-center">Loading reports...</td></tr>
                            </tbody>
                        </table>

                        <div class="text-center">
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="sonnetPaginationControls"></ul>
                            </nav>
                            <div style="margin-top: 10px;">
                                <label style="margin-right: 10px;">Show:</label>
                                <select id="sonnetPageSize" class="form-control" style="width: auto; display: inline-block;">
                                    <option value="25">25</option>
                                    <option value="50" selected>50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                </select>
                                <span style="margin-left: 10px;" id="sonnetRecordInfo"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Agentic Property-Based Testing | <a href="https://github.com/mmaaz-git/agentic-pbt-site">View on GitHub</a></p>
        </div>
    </div>

    <!-- Modal for displaying reports -->
    <div id="reportModal" class="report-modal">
        <div class="report-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="modalContent">
                <div class="loading-spinner">Loading report...</div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>
        // Global state
        let currentModel = 'opus';
        let opusData = { reports: [], filtered: [], currentPage: 1, recordsPerPage: 50 };
        let sonnetData = { reports: [], filtered: [], currentPage: 1, recordsPerPage: 50 };

        // Configure marked for better markdown rendering
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Switch between models
        function switchModel(model) {
            currentModel = model;

            // Update tab buttons
            document.getElementById('opusTab').classList.remove('active');
            document.getElementById('sonnetTab').classList.remove('active');
            document.getElementById(model + 'Tab').classList.add('active');

            // Update content visibility
            document.getElementById('opusContent').classList.remove('active');
            document.getElementById('sonnetContent').classList.remove('active');
            document.getElementById(model + 'Content').classList.add('active');
        }

        // Load both datasets
        Promise.all([
            fetch('data-opus-4.1.json').then(r => r.json()),
            fetch('data-sonnet-4.5.json').then(r => r.json())
        ]).then(([opusJson, sonnetJson]) => {
            // Initialize Opus data
            opusData.reports = opusJson.reports;
            opusData.filtered = [...opusData.reports];

            // Populate Opus package filter
            const opusPackages = [...new Set(opusData.reports.map(r => r.package))].sort();
            const opusPackageFilter = document.getElementById('opusPackageFilter');
            opusPackages.forEach(pkg => {
                const option = document.createElement('option');
                option.value = pkg;
                option.textContent = pkg;
                opusPackageFilter.appendChild(option);
            });

            // Set up Opus event listeners
            document.getElementById('opusSearchInput').addEventListener('input', applyOpusFilters);
            document.getElementById('opusPackageFilter').addEventListener('change', applyOpusFilters);
            document.getElementById('opusMinScoreFilter').addEventListener('input', applyOpusFilters);
            document.getElementById('opusMaxScoreFilter').addEventListener('input', applyOpusFilters);
            document.getElementById('opusStatusFilter').addEventListener('change', applyOpusFilters);
            document.getElementById('opusPageSize').addEventListener('change', function() {
                opusData.recordsPerPage = parseInt(this.value);
                opusData.currentPage = 1;
                displayOpusReports();
            });

            // Initialize Sonnet data
            sonnetData.reports = sonnetJson.reports;
            sonnetData.filtered = [...sonnetData.reports];

            // Populate Sonnet package filter
            const sonnetPackages = [...new Set(sonnetData.reports.map(r => r.package))].sort();
            const sonnetPackageFilter = document.getElementById('sonnetPackageFilter');
            sonnetPackages.forEach(pkg => {
                const option = document.createElement('option');
                option.value = pkg;
                option.textContent = pkg;
                sonnetPackageFilter.appendChild(option);
            });

            // Set up Sonnet event listeners
            document.getElementById('sonnetSearchInput').addEventListener('input', applySonnetFilters);
            document.getElementById('sonnetPackageFilter').addEventListener('change', applySonnetFilters);
            document.getElementById('sonnetCategoryFilter').addEventListener('change', applySonnetFilters);
            document.getElementById('sonnetSeverityFilter').addEventListener('change', applySonnetFilters);
            document.getElementById('sonnetStatusFilter').addEventListener('change', applySonnetFilters);
            document.getElementById('sonnetPageSize').addEventListener('change', function() {
                sonnetData.recordsPerPage = parseInt(this.value);
                sonnetData.currentPage = 1;
                displaySonnetReports();
            });

            // Display initial data
            displayOpusReports();
            displaySonnetReports();
        }).catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('opusTableBody').innerHTML =
                '<tr><td colspan="6" class="text-center text-danger">Error loading data</td></tr>';
            document.getElementById('sonnetTableBody').innerHTML =
                '<tr><td colspan="7" class="text-center text-danger">Error loading data</td></tr>';
        });

        // Opus Functions
        function displayOpusReports() {
            const tbody = document.getElementById('opusTableBody');

            if (opusData.filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No reports match your filters</td></tr>';
                document.getElementById('opusPaginationControls').innerHTML = '';
                document.getElementById('opusRecordInfo').textContent = '';
                return;
            }

            const startIndex = (opusData.currentPage - 1) * opusData.recordsPerPage;
            const endIndex = Math.min(startIndex + opusData.recordsPerPage, opusData.filtered.length);
            const paginatedReports = opusData.filtered.slice(startIndex, endIndex);

            document.getElementById('opusRecordInfo').textContent =
                `Showing ${startIndex + 1}-${endIndex} of ${opusData.filtered.length} reports`;

            tbody.innerHTML = paginatedReports.map((report, index) => {
                const actualIndex = startIndex + index;

                let scoreDisplay = '';
                if (report.score && report.score.total_score !== null) {
                    scoreDisplay = `<span class="score-badge">${report.score.total_score}/15</span>`;
                } else {
                    scoreDisplay = `<span class="score-badge score-na">N/A</span>`;
                }

                const status = report.bug_status ? report.bug_status.status : 'unknown';
                const statusUrl = report.bug_status ? report.bug_status.url : '';

                let statusDisplay = '';
                if (statusUrl) {
                    statusDisplay = `<a href="${statusUrl}" target="_blank" onclick="event.stopPropagation();" style="text-decoration: none;">
                        <span class="status-badge status-${status}" style="cursor: pointer;">${status}</span>
                    </a>`;
                } else {
                    statusDisplay = `<span class="status-badge status-${status}">${status}</span>`;
                }

                return `
                    <tr class="report-row" onclick="viewReport('${report.file_path}')">
                        <td><span class="package-badge">${escapeHtml(report.package)}</span></td>
                        <td>${escapeHtml(report.title)}</td>
                        <td>${scoreDisplay}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); viewReport('${report.file_path}')">View</button>
                        </td>
                        <td>
                            ${report.score ? `<button class="btn btn-info btn-sm" onclick="event.stopPropagation(); viewOpusReview(${actualIndex})">View</button>` : '<span style="color: #999;">-</span>'}
                        </td>
                        <td>${statusDisplay}</td>
                    </tr>
                `;
            }).join('');

            renderOpusPagination();
        }

        function renderOpusPagination() {
            const totalPages = Math.ceil(opusData.filtered.length / opusData.recordsPerPage);
            const paginationControls = document.getElementById('opusPaginationControls');

            if (totalPages <= 1) {
                paginationControls.innerHTML = '';
                return;
            }

            let html = '';
            html += `<li class="${opusData.currentPage === 1 ? 'disabled' : ''}">
                <a href="#" onclick="changeOpusPage(${opusData.currentPage - 1}); return false;" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>`;

            const maxPagesToShow = 10;
            let startPage = Math.max(1, opusData.currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

            if (endPage - startPage < maxPagesToShow - 1) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }

            if (startPage > 1) {
                html += '<li><a href="#" onclick="changeOpusPage(1); return false;">1</a></li>';
                if (startPage > 2) html += '<li class="disabled"><span>...</span></li>';
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="${i === opusData.currentPage ? 'active' : ''}">
                    <a href="#" onclick="changeOpusPage(${i}); return false;">${i}</a>
                </li>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<li class="disabled"><span>...</span></li>';
                html += `<li><a href="#" onclick="changeOpusPage(${totalPages}); return false;">${totalPages}</a></li>`;
            }

            html += `<li class="${opusData.currentPage === totalPages ? 'disabled' : ''}">
                <a href="#" onclick="changeOpusPage(${opusData.currentPage + 1}); return false;" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>`;

            paginationControls.innerHTML = html;
        }

        function changeOpusPage(page) {
            const totalPages = Math.ceil(opusData.filtered.length / opusData.recordsPerPage);
            if (page < 1 || page > totalPages) return;
            opusData.currentPage = page;
            displayOpusReports();
            document.querySelector('.bug-report-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function applyOpusFilters() {
            opusData.currentPage = 1;
            const searchTerm = document.getElementById('opusSearchInput').value.toLowerCase();
            const packageFilter = document.getElementById('opusPackageFilter').value;
            const minScore = document.getElementById('opusMinScoreFilter').value;
            const maxScore = document.getElementById('opusMaxScoreFilter').value;
            const statusFilter = document.getElementById('opusStatusFilter').value;

            opusData.filtered = opusData.reports.filter(report => {
                const matchesSearch = !searchTerm ||
                    report.title.toLowerCase().includes(searchTerm) ||
                    report.package.toLowerCase().includes(searchTerm) ||
                    (report.target && report.target.toLowerCase().includes(searchTerm));

                const matchesPackage = !packageFilter || report.package === packageFilter;

                let matchesScore = true;
                if ((minScore !== '' || maxScore !== '') && report.score && report.score.total_score !== null) {
                    const score = report.score.total_score;
                    const min = minScore !== '' ? parseInt(minScore) : 0;
                    const max = maxScore !== '' ? parseInt(maxScore) : 15;
                    matchesScore = score >= min && score <= max;
                } else if ((minScore !== '' || maxScore !== '') && (!report.score || report.score.total_score === null)) {
                    matchesScore = false;
                }

                const matchesStatus = !statusFilter ||
                    (report.bug_status && report.bug_status.status === statusFilter);

                return matchesSearch && matchesPackage && matchesScore && matchesStatus;
            });

            displayOpusReports();
        }

        function clearOpusFilters() {
            document.getElementById('opusSearchInput').value = '';
            document.getElementById('opusPackageFilter').value = '';
            document.getElementById('opusMinScoreFilter').value = '';
            document.getElementById('opusMaxScoreFilter').value = '';
            document.getElementById('opusStatusFilter').value = '';
            applyOpusFilters();
        }

        function viewOpusReview(reportIndex) {
            const report = opusData.filtered[reportIndex];
            if (!report || !report.score) return;

            const modal = document.getElementById('reportModal');
            const modalContent = document.getElementById('modalContent');

            modal.style.display = 'block';

            let analysisHtml = '<p>No detailed review available.</p>';
            if (report.score.response) {
                analysisHtml = marked.parse(report.score.response);
            }

            const reviewHtml = `
                <div style="color: #666; font-size: 14px; margin-bottom: 15px; font-family: monospace;">
                    ${report.file_name} - Review
                </div>
                <h2>Score Summary</h2>
                <table class="table table-bordered">
                    <tr>
                        <th style="width: 70%;">Criterion</th>
                        <th style="width: 30%;">Score</th>
                    </tr>
                    <tr>
                        <td>Obviousness</td>
                        <td><strong>${report.score.obviousness || 'N/A'}/5</strong></td>
                    </tr>
                    <tr>
                        <td>Input Reasonableness</td>
                        <td><strong>${report.score.input_reasonableness || 'N/A'}/5</strong></td>
                    </tr>
                    <tr>
                        <td>Maintainer Defensibility</td>
                        <td><strong>${report.score.maintainer_defensibility || 'N/A'}/5</strong></td>
                    </tr>
                    <tr style="background-color: #f5f5f5;">
                        <th>Total Score</th>
                        <th>${report.score.total_score || 'N/A'}/15</th>
                    </tr>
                </table>
                <h2>Detailed Analysis</h2>
                <div class="review-content">
                    ${analysisHtml}
                </div>
            `;

            modalContent.innerHTML = reviewHtml;

            modalContent.querySelectorAll('pre code').forEach((block) => {
                Prism.highlightElement(block);
            });
        }

        // Sonnet Functions
        function displaySonnetReports() {
            const tbody = document.getElementById('sonnetTableBody');

            if (sonnetData.filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">No reports match your filters</td></tr>';
                document.getElementById('sonnetPaginationControls').innerHTML = '';
                document.getElementById('sonnetRecordInfo').textContent = '';
                return;
            }

            const startIndex = (sonnetData.currentPage - 1) * sonnetData.recordsPerPage;
            const endIndex = Math.min(startIndex + sonnetData.recordsPerPage, sonnetData.filtered.length);
            const paginatedReports = sonnetData.filtered.slice(startIndex, endIndex);

            document.getElementById('sonnetRecordInfo').textContent =
                `Showing ${startIndex + 1}-${endIndex} of ${sonnetData.filtered.length} reports`;

            tbody.innerHTML = paginatedReports.map((report, index) => {
                const actualIndex = startIndex + index;
                const categoryClass = `category-${report.category}`;
                const categoryBadge = `<span class="category-badge ${categoryClass}">${report.category}</span>`;

                let severityDisplay = '';
                if (report.severity && report.severity !== 'N/A') {
                    const severityLower = report.severity.toLowerCase().replace(/[^a-z]/g, '');
                    const severityClass = severityLower.includes('critical') ? 'severity-critical' :
                                         severityLower.includes('high') ? 'severity-high' :
                                         severityLower.includes('medium') ? 'severity-medium' :
                                         severityLower.includes('low') ? 'severity-low' : '';
                    severityDisplay = `<span class="${severityClass}">${report.severity}</span>`;
                } else {
                    severityDisplay = '<span style="color: #999;">N/A</span>';
                }

                const status = report.bug_status ? report.bug_status.status : 'unknown';
                const statusUrl = report.bug_status ? report.bug_status.url : '';

                let statusDisplay = '';
                if (statusUrl) {
                    statusDisplay = `<a href="${statusUrl}" target="_blank" onclick="event.stopPropagation();" style="text-decoration: none;">
                        <span class="status-badge status-${status}" style="cursor: pointer;">${status}</span>
                    </a>`;
                } else {
                    statusDisplay = `<span class="status-badge status-${status}">${status}</span>`;
                }

                return `
                    <tr class="report-row" onclick="viewReport('${report.file_path}')">
                        <td><span class="package-badge">${escapeHtml(report.package)}</span></td>
                        <td>${escapeHtml(report.title)}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); viewReport('${report.file_path}')">View</button>
                        </td>
                        <td>
                            ${report.analysis_path ? `<button class="btn btn-info btn-sm" onclick="event.stopPropagation(); viewSonnetAnalysis(${actualIndex})">View</button>` : '<span style="color: #999;">-</span>'}
                        </td>
                        <td>${categoryBadge}</td>
                        <td>${severityDisplay}</td>
                        <td>${statusDisplay}</td>
                    </tr>
                `;
            }).join('');

            renderSonnetPagination();
        }

        function renderSonnetPagination() {
            const totalPages = Math.ceil(sonnetData.filtered.length / sonnetData.recordsPerPage);
            const paginationControls = document.getElementById('sonnetPaginationControls');

            if (totalPages <= 1) {
                paginationControls.innerHTML = '';
                return;
            }

            let html = '';
            html += `<li class="${sonnetData.currentPage === 1 ? 'disabled' : ''}">
                <a href="#" onclick="changeSonnetPage(${sonnetData.currentPage - 1}); return false;" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>`;

            const maxPagesToShow = 10;
            let startPage = Math.max(1, sonnetData.currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

            if (endPage - startPage < maxPagesToShow - 1) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }

            if (startPage > 1) {
                html += '<li><a href="#" onclick="changeSonnetPage(1); return false;">1</a></li>';
                if (startPage > 2) html += '<li class="disabled"><span>...</span></li>';
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="${i === sonnetData.currentPage ? 'active' : ''}">
                    <a href="#" onclick="changeSonnetPage(${i}); return false;">${i}</a>
                </li>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<li class="disabled"><span>...</span></li>';
                html += `<li><a href="#" onclick="changeSonnetPage(${totalPages}); return false;">${totalPages}</a></li>`;
            }

            html += `<li class="${sonnetData.currentPage === totalPages ? 'disabled' : ''}">
                <a href="#" onclick="changeSonnetPage(${sonnetData.currentPage + 1}); return false;" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>`;

            paginationControls.innerHTML = html;
        }

        function changeSonnetPage(page) {
            const totalPages = Math.ceil(sonnetData.filtered.length / sonnetData.recordsPerPage);
            if (page < 1 || page > totalPages) return;
            sonnetData.currentPage = page;
            displaySonnetReports();
            document.querySelector('.bug-report-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function applySonnetFilters() {
            sonnetData.currentPage = 1;
            const searchTerm = document.getElementById('sonnetSearchInput').value.toLowerCase();
            const packageFilter = document.getElementById('sonnetPackageFilter').value;
            const categoryFilter = document.getElementById('sonnetCategoryFilter').value;
            const severityFilter = document.getElementById('sonnetSeverityFilter').value;
            const statusFilter = document.getElementById('sonnetStatusFilter').value;

            sonnetData.filtered = sonnetData.reports.filter(report => {
                const matchesSearch = !searchTerm ||
                    report.title.toLowerCase().includes(searchTerm) ||
                    report.package.toLowerCase().includes(searchTerm) ||
                    (report.target && report.target.toLowerCase().includes(searchTerm));

                const matchesPackage = !packageFilter || report.package === packageFilter;

                const matchesCategory = !categoryFilter || report.category === categoryFilter;

                const matchesSeverity = !severityFilter ||
                    (report.severity && report.severity.toLowerCase().includes(severityFilter.toLowerCase()));

                const matchesStatus = !statusFilter ||
                    (report.bug_status && report.bug_status.status === statusFilter);

                return matchesSearch && matchesPackage && matchesCategory && matchesSeverity && matchesStatus;
            });

            displaySonnetReports();
        }

        function clearSonnetFilters() {
            document.getElementById('sonnetSearchInput').value = '';
            document.getElementById('sonnetPackageFilter').value = '';
            document.getElementById('sonnetCategoryFilter').value = '';
            document.getElementById('sonnetSeverityFilter').value = '';
            document.getElementById('sonnetStatusFilter').value = '';
            applySonnetFilters();
        }

        function viewSonnetAnalysis(reportIndex) {
            const report = sonnetData.filtered[reportIndex];
            if (!report || !report.analysis_path) return;

            const modal = document.getElementById('reportModal');
            const modalContent = document.getElementById('modalContent');

            modal.style.display = 'block';
            modalContent.innerHTML = '<div class="loading-spinner">Loading analysis...</div>';

            fetch(report.analysis_path)
                .then(response => response.text())
                .then(text => {
                    const analysisMarkdown = marked.parse(text);
                    const analysisHtml = `
                        <div style="color: #666; font-size: 14px; margin-bottom: 15px; font-family: monospace;">
                            ${report.file_name} - Analysis
                        </div>
                        <h2>Category: ${report.category}</h2>
                        <div>
                            ${analysisMarkdown}
                        </div>
                    `;
                    modalContent.innerHTML = analysisHtml;

                    // Apply syntax highlighting to code blocks
                    modalContent.querySelectorAll('pre code').forEach((block) => {
                        Prism.highlightElement(block);
                    });
                })
                .catch(error => {
                    modalContent.innerHTML = '<div class="alert alert-danger">Error loading analysis: ' + error.message + '</div>';
                    console.error('Error loading analysis:', error);
                });
        }

        // Shared Functions
        function viewReport(filePath) {
            const modal = document.getElementById('reportModal');
            const modalContent = document.getElementById('modalContent');

            modal.style.display = 'block';
            modalContent.innerHTML = '<div class="loading-spinner">Loading report...</div>';

            fetch(filePath)
                .then(response => response.text())
                .then(markdown => {
                    const html = marked.parse(markdown);
                    const filename = filePath.split('/').pop();
                    modalContent.innerHTML = `
                        <div style="color: #666; font-size: 14px; margin-bottom: 15px; font-family: monospace;">
                            ${filename}
                        </div>
                        ${html}
                    `;

                    modalContent.querySelectorAll('pre code').forEach((block) => {
                        Prism.highlightElement(block);
                    });
                })
                .catch(error => {
                    modalContent.innerHTML = '<div class="alert alert-danger">Error loading report: ' + error.message + '</div>';
                    console.error('Error loading report:', error);
                });
        }

        function closeModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
